<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Elements .NET Core MVC app | elementsproject.org</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Elements .NET Core MVC app" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Elements - an open source, sidechain-capable blockchain platform." />
<meta property="og:description" content="Elements - an open source, sidechain-capable blockchain platform." />
<link rel="canonical" href="http://localhost:4000/elements-code-tutorial/web-application-dotnetcore" />
<meta property="og:url" content="http://localhost:4000/elements-code-tutorial/web-application-dotnetcore" />
<meta property="og:site_name" content="elementsproject.org" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Elements .NET Core MVC app" />
<script type="application/ld+json">
{"url":"http://localhost:4000/elements-code-tutorial/web-application-dotnetcore","@type":"WebPage","description":"Elements - an open source, sidechain-capable blockchain platform.","headline":"Elements .NET Core MVC app","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link href='/assets/open-sans.css' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/bootstrap-v3.3.7.min.css">
  <script src="/assets/jquery-v3.3.1.min.js"></script>
  <script src="/assets/bootstrap-v3.3.7.min.js"></script><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="elementsproject.org" /></head>
<body><header class="site-header" role="banner">

<div class="wrapper">
  <img class="logo-float-left" alt="" src="http://localhost:4000/images/basantech_logo_no_border.png" /><span><a class="site-title" rel="author" href="/">elementsproject.org</a></span>
</div>

<nav class="navbar navbar-default navbar-elements-narrow">
  <div class="container-fluid">

    <!-- Enable mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapsing-nav-bar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>

    <!-- Nav links for toggling -->
    <div class="collapse navbar-collapse" id="collapsing-nav-bar">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/how-it-works">How it works</a></li> 
        <li><a href="/features">Features</a></li>
        <!-- <li><a href="/community">Community</a></li> -->
        <li><a href="/en/doc">RPC Docs</a></li>
        <!-- <li><a href="https://github.com/ElementsProject/elements/releases">Download</a></li> -->

        <li class="dropdown">
          <a data-toggle="dropdown" role="button">Code Tutorial<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/elements-code-tutorial/overview">Tutorial Overview</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/elements-code-tutorial/installing-bitcoin">Installing Bitcoin</a></li>
            <li><a href="/elements-code-tutorial/installing-elements">Installing Elements</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/elements-code-tutorial/working-environment">Setting up your working environment</a></li>
            <li><a href="/elements-code-tutorial/basic-operations">Using Elements to perform basic operations</a></li>
            <li><a href="/elements-code-tutorial/confidential-transactions">Using Confidential Transactions</a></li>
            <li><a href="/elements-code-tutorial/issuing-assets">Issuing your own assets</a></li>
            <li><a href="/elements-code-tutorial/reissuing-assets">Reissuing assets</a></li>
            <li><a href="/elements-code-tutorial/block-creation">Block creation in a Strong Federation</a></li>
            <li><a href="/elements-code-tutorial/sidechain">Elements as a Sidechain</a></li>
            <li><a href="/elements-code-tutorial/blockchain">Elements as a standalone Blockchain</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/elements-code-tutorial/application-development">Developing applications on Elements</a></li>
            <li><a href="/elements-code-tutorial/desktop-application-python">Desktop application example in Python</a></li>
            <li><a href="/elements-code-tutorial/web-application">Web application example in Python using Flask</a></li>
            <li><a href="/elements-code-tutorial/desktop-application-dotnetcore">Desktop application example in C# using .NET Core</a></li>
            <li><a href="/elements-code-tutorial/web-application-dotnetcore">MVC Web application example in C# using .NET Core</a></li>
            <li><a href="/elements-code-tutorial/other-languages">Go, Ruby, Java, Perl examples</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/elements-code-tutorial/easy-run-code">An easy way to run the main tutorial code</a></li>
            <li><a href="/elements-code-tutorial/advanced-examples">Advanced examples</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="https://github.com/ElementsProject/elements">Elements on Github</a></li>
          </ul>
        </li>   
      </ul>

    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<script>
$(document).ready(function() {
  // Assign the 'active' class for currently viewed page 

  var pathname = window.location.pathname;
  // Remove trailng '/'
  if (pathname.charAt(pathname.length - 1) == '/') {
    pathname = pathname.substr(0, pathname.length - 1);
  }

  // Sub pages not in sub menu (e.g. features/confidential-transactions)
  var secondForwardSlashIndex = pathname.indexOf("/", 1);
  if (-1 != secondForwardSlashIndex)
  {
    mainpathname = pathname.substr(0, secondForwardSlashIndex);
    $('.nav > li > a[href="'+mainpathname+'"]').parent().addClass('active');
  }
  
  // Top level nav bar item
  $('.nav > li > a[href="'+pathname+'"]').parent().addClass('active');

  // Nav bar drop down item - must be linked to with the "/" prefix (e.g. /elements-code-tutorial/) in the menu html above
  $('.nav > li > ul> li > a[href="'+pathname+'"]').parent().parent().parent().addClass('active');  

  // Nav bar drop down sub item
  $('.nav > li > ul> li > a[href="'+pathname+'"]').parent().addClass('active');
})
</script>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <div class="post-content">
    <h1 id="elements-code-tutorial">Elements code tutorial</h1>

<h2 id="mvc-web-application-example-in-c-using-net-core">MVC Web application example in C# using .NET Core</h2>

<p><img class="" alt="" src="http://localhost:4000/images/elementsmvc.png" /></p>

<p>Microsoft have created an open source version of their .NET platform called .NET Core that runs on a variety of operating systems. We will use C# (the most popular .NET language) for this example and build an application using the MVC web framework.</p>

<h3 id="installing-the-net-core-sdk">Installing the .NET Core SDK</h3>

<p>You can skip this step if you already have the .NET Core SDK installed.</p>

<p>Before installing the .NET Core SDK, you’ll need to register the Microsoft key used to validate the required repository, register the product repository itself, and then install the required dependencies.</p>

<p>Open a command prompt and run the following two commands.</p>

<h5 id="note-the-command-you-run-after-wget-is-dependant-on-the-which-distribution-of-linux-you-are-running-please-check-here-to-get-the-right-one-there-are-only-two-lines-below-so-note-the-text-wrap-the-first-starts-with-wget-the-second-with-sudo">NOTE: The command you run after ‘wget’ is dependant on the which distribution of Linux you are running. Please check <a href="https://dotnet.microsoft.com/download/linux-package-manager/rhel/sdk-current">here</a> to get the right one. There are only two lines below so note the text wrap. The first starts with “wget”, the second with “sudo”.</h5>

<pre><code>wget -q https://packages.microsoft.com/config/ubuntu/18.04/packages-microsoft-prod.deb
sudo dpkg -i packages-microsoft-prod.deb
</code></pre>

<p>Now we can install the .NET Core SDK:</p>

<pre><code>sudo add-apt-repository universe
sudo apt-get install apt-transport-https
sudo apt-get update
sudo apt-get install dotnet-sdk-2.1
</code></pre>

<h3 id="creating-the-application">Creating the application</h3>

<p>We will be using the Model, View, Controller (MVC) pattern for our app. We will also be using an existing class to handle the calls to our Elements daemon and simplify our code. We will amend the default Home controller to call this class and pass the data it returns back to the relevant View using a new Model that we’ll also create.</p>

<p>To get started, create a directory for our MVC app and move into it:</p>

<pre><code>mkdir ElementsMVC
cd ElementsMVC
</code></pre>

<p>Use the dotnet tool to create a new template mvc site. This will set up the required folder structure, files, and configuration needed to serve the web app:</p>

<pre><code>dotnet new mvc
</code></pre>

<p>Check it is set up correctly by running the app:</p>

<pre><code>dotnet run
</code></pre>

<p>When it says the application has started, browse to <a href="https://localhost:5001">https://localhost:5001</a></p>

<p>You should see the template site running, all we have to do is add our own code to what’s already there.</p>

<p>Shut the app down using Ctrl+C.</p>

<p>Now we will start adding our own code so that we can query our Elements node and display the results on the app’s home page.</p>

<p>Create a new file named <strong>dotnetcoreDynamicJSON-RPC.cs</strong> in the ElementsMVC directory and paste in the <a href="https://raw.githubusercontent.com/wintercooled/dotnetcoreDynamicJSON-RPC/master/dotnetcoreDynamicJSON-RPC.cs">raw code</a> of the ‘Dynamic JSON RPC class’ and save it. Alternatively, clone the <a href="https://github.com/wintercooled/dotnetcoreDynamicJSON-RPC">GitHub repository</a> into a different directory and copy the dotnetcoreDynamicJSON-RPC.cs file into your ElementsMVC directory.</p>

<p>This class is a C# wrapper class intended to enable simple dynamic JSON RPC calls to Bitcoin, Elements and other RPC enabled daemons. The project, along with examples of how to use it, can be found <a href="https://github.com/wintercooled/dotnetcoreDynamicJSON-RPC">here</a>. All we need for now though is to copy the code from the raw link</p>

<p>That class enables us to easily query our node. We’ll add the code to call it soon, first we need a way to pass the data that we get back from our node to the web page for display. For that we need a Model. We’ll create a simple one that you can add to later.</p>

<p>Create a new file named <strong>ExampleNodeInfo.cs</strong> in ElementsMVC/Models and paste the following into it:</p>

<pre><code>using System;

namespace ElementsMVC.Models
{
    public class ExampleNodeInfo
    {
        public string Balance { get; set; }
        
        public string Message { get; set; }
        //Add whatever other properties you want here
    }
}
</code></pre>

<p>Now we have; a way to get data from our node, a Model that lets us pass the data to the View for display.</p>

<p>Open the <strong>HomeController.cs</strong> file in ElementsMVC/Controllers. We will be adding code to call the Dynamic JSON RPC class to get data from our Elements node, populate our Model with the results and hand the Model to the landing page’s View for display.</p>

<p>To the top of the HomeController.cs file, add the following:</p>

<pre><code>using DotnetcoreDynamicJSONRPC;
</code></pre>

<p>Then replace the Index method so it looks like the following.</p>

<h5 id="note-edit-the-4-rpc-related-variables-to-authenticate-against-the-node-you-are-using-if-they-differ-from-the-defaults-we-have-been-using-for-the-rest-of-the-tutorial-some-of-the-lines-below-may-wrap-when-viewed-in-a-browser">NOTE: Edit the 4 rpc related variables to authenticate against the node you are using if they differ from the defaults we have been using for the rest of the tutorial. Some of the lines below may wrap when viewed in a browser.</h5>
<pre><code>public IActionResult Index()
{
    // We will be using an Elements node in this example. 
    // It is easy to switch to use a Bitcoin, Liquid node.
    // You need to change these to make sure you can authenticate against the daemon you are running:
    string rpcUrl = "http://localhost";
    string rpcPort = "18884";
    string rpcUsername = "user1";
    string rpcPassword = "password1";

    // For examples and notes on how to use the dotnetcoreDynamicJSON-RPC tool and its JSON helper methods please see:
    // https://github.com/wintercooled/dotnetcoreDynamicJSON-RPC            

    // Initialise an instance of the dynamic dotnetcoreDynamicJSON_RPC class.
    dynamic dynamicRPC = new DynamicRPC(rpcUrl, rpcPort, rpcUsername, rpcPassword);

    // Initialise our model that will be passed to the view
    var nodeInfo = new ExampleNodeInfo();

    if (dynamicRPC.DaemonIsRunning())
    {
        try
        {
            // Get the JSON result of the 'getwalletinfo' RPC on the Elements node.
            string balance = dynamicRPC.getwalletinfo();

            // Use the DotnetcoreDynamicJSONRPC 'GetProperty' string helper to return the property value we want.
            balance = balance.GetProperty("result.balance.bitcoin");

            // Populate the model
            nodeInfo.Balance = balance;
        }
        catch (Exception e)
        {
            nodeInfo.Message = e.Message;
        }
    }
    else
    {
        nodeInfo.Message = "Could not communicate with daemon";
    }

    // Return the view and the associated model we have populated
    return View(nodeInfo);
}
</code></pre>

<p>Next, edit the <strong>Index.cshtml</strong> file in ElementsMVC/Views/Home and replace all the existing content with the following code. The code takes our Model and displays the data in it on the default web page.</p>

<pre><code>@model ElementsMVC.Models.ExampleNodeInfo

@{
    ViewData["Title"] = "Index";
}

&lt;h2&gt;Example Node Info&lt;/h2&gt;

@{
    if (Model.Message != "")
    {
        &lt;h3&gt;@Model.Message&lt;/h3&gt;
    }
}

&lt;div&gt;
    &lt;h4&gt;Basic Wallet Info&lt;/h4&gt;
    &lt;hr /&gt;
    &lt;dl class="dl-horizontal"&gt;
        &lt;dt&gt;
            @Html.DisplayNameFor(model =&gt; model.Balance)
        &lt;/dt&gt;
        &lt;dd&gt;
            @Html.DisplayFor(model =&gt; model.Balance)
        &lt;/dd&gt;
    &lt;/dl&gt;
&lt;/div&gt;
</code></pre>

<h3 id="running-the-application">Running the application</h3>

<p>Before we try running our code we’ll make sure the required daemons are running:</p>

<pre><code>cd
cd elements
cd src
bitcoind -datadir=$HOME/bitcoindir
./elementsd -datadir=$HOME/elementsdir1
</code></pre>

<p>If you get an error saying they are already running that’s fine.</p>

<h5 id="note-if-you-get-an-error-connecting-to-the-elements-client-when-you-run-the-code-below-it-may-be-because-your-node-has-been-left-in-an-altered-state-after-quitting-the-tutorial-code-at-an-early-stage-to-refresh-and-reset-the-daemons-blockchain-and-config-files-re-run-the-first-section-of-the-tutorial-code-up-to-and-including-the-lines-where-the-3-config-files-are-copied-into-the-new-directories-then-run-the-commands-above-to-start-the-required-daemons">NOTE: If you get an error connecting to the elements client when you run the code below it may be because your node has been left in an altered state after quitting the tutorial code at an early stage. To refresh and reset the daemon’s blockchain and config files re-run the first section of the tutorial code up to and including the lines where the 3 config files are copied into the new directories, then run the commands above to start the required daemons.</h5>

<p>Now we can run our code. Make sure your terminal is at the ElementsMVC directory level and run the following:</p>

<pre><code>dotnet run
</code></pre>

<p>When it says the application has started, browse to <a href="https://localhost:5001">https://localhost:5001</a></p>

<p>The balance of our Elements node’s wallet is displayed on the page!</p>

<h3 id="next-steps">Next steps</h3>

<p>That should have got you up and running and in order to extend your application, you can look at the examples on the <a href="https://github.com/wintercooled/dotnetcoreDynamicJSON-RPC">Dynamic JSON RPC class</a> GitHub site.</p>

<p><a href="http://localhost:4000/elements-code-tutorial/other-languages">Next: Other language examples</a></p>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <img class="logo-footer" alt="" src="http://localhost:4000/images/elements_logo_no_border.png" /> 
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list"><li class="footer-links"><a href="https://github.com/ElementsProject/elementsproject.github.io">elementsproject.org github</a></li><li class="footer-links"><a href="https://github.com/ElementsProject/elements">elements github</a></li></ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Elements - an open source, sidechain-capable blockchain platform.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
